+function(n){var t={urlObj:{getCart:"",updateCart:"",deleteCart:"",getDistrict:"",payment:"",checkVoucher:"",getShip:""},postData:{CUS_NAME:"",PHONE:"",EMAIL:"",ADDRESS:"",CITY_ID:"",DISTRICT_ID:"",NOTE:"",PAYMENT_FORMOLY:"",VOUCHER_CODE:"",TIME_SHIP:""},pricePostData:{ship:0,voucher:0,totalCart:0},init:function(){t.load.event();t.load.getCart()},load:{event:function(){n(".order-body").on("change",".txtCartQty",function(){var i=n(this).val(),r=n(this).parents(".item_minicart").attr("data-id");t.action.updateCart(r,i)});n(".order-body").on("click",".btn-remove",function(){var i=n(this).parents(".item_minicart").attr("data-id");t.action.deleteCart(i)});n("#CITY_ID").change(function(){var i=n(this).val();n.ajax({url:t.urlObj.getDistrict,data:{cityId:i},type:"POST",success:function(t){var r=[],i,u;for(r.push('<option value="">Quận/huyện<\/option>'),i=0;i<t.length;i++)u=t[i],r.push('<option value="'+u.KEY+'">'+u.VALUE+"<\/option>");n("#DISTRICT_ID").html(r.join(""))}})});n("#DISTRICT_ID").change(function(){var i=n(this).val();t.load.getShip(i)});n(".btn-payment").click(function(){t.action.setPostData();var i=t.action.validateForn();return i!=""?showDialog(i,"Thông báo"):t.action.payment(n(this)),!1});n(".btn_voucher").click(function(){t.action.checkVoucher()})},getCart:function(){n.ajax({url:t.urlObj.getCart,type:"POST",async:!1,success:function(i){var r=t.template.createTemplateCart(i.info);n(".order-body").html(r.join(""));n(".total-price").html(i.totalMoneyFormat);t.pricePostData.totalCart=i.totalMoney;t.load.getTotalAmount()}})},getShip:function(i){n.ajax({url:t.urlObj.getShip,data:{districtId:i},type:"POST",success:function(i){n(".total-ship").html(i.ShipFormat);i.Ship>0&&(t.pricePostData.ship=i.Ship);t.load.getTotalAmount()}})},getTotalAmount:function(){var i=t.pricePostData.ship+t.pricePostData.totalCart-t.pricePostData.voucher;n(".total-amount-price").html(i.format(0,3,",","."))}},action:{payment:function(i){i.attr("disabled","true");n("body").addClass("loading");n.ajax({url:t.urlObj.payment,type:"POST",data:t.postData,success:function(t){i.removeAttr("disabled");n("body").removeClass("loading");t.MsgNotify?showDialog(t.MsgNotify,"Thông báo"):document.location="/dat-hang-thanh-cong?orderId="+t.OrderId},error:function(n,t,i){alert(n.status);alert(i)}})},checkVoucher:function(){var i=n(".code_voucher").val();i?n.ajax({url:t.urlObj.checkVoucher,data:{code:i},type:"POST",success:function(n){showDialog(n.Msg,"Thông báo")}}):showDialog("Vui lòng nhập mã voucher","Cảnh báo")},updateCart:function(i,r){n.ajax({url:t.urlObj.updateCart,type:"POST",data:{productId:i,quantity:r},success:function(){t.load.getCart()}})},deleteCart:function(i){n.ajax({url:t.urlObj.deleteCart,type:"POST",data:{productId:i},success:function(){t.load.getCart()}})},setPostData:function(){t.postData.CUS_NAME=n("#CUS_NAME").val();t.postData.PHONE=n("#PHONE").val();t.postData.EMAIL=n("#EMAIL").val();t.postData.ADDRESS=n("#ADDRESS").val();t.postData.CITY_ID=n("#CITY_ID").val();t.postData.DISTRICT_ID=n("#DISTRICT_ID").val();t.postData.NOTE=n("#NOTE").val();t.postData.VOUCHER_CODE=n(".code_voucher").val();t.postData.PAYMENT_FORMOLY=n("input[name='PAYMENT_FORMOLY']:checked").val();t.postData.TIME_SHIP=n("input[name='TIME_SHIP']:checked").val()},validateForn:function(){var n="";return t.postData.CUS_NAME?t.postData.PHONE?t.postData.PHONE&&!checkValidatePhone(t.postData.PHONE)?n="Số điện thoại định dạng chưa đúng":t.postData.EMAIL&&!checkEmail(t.postData.EMAIL)?n="Email định dạng chưa đúng":t.postData.ADDRESS?t.postData.CITY_ID?t.postData.DISTRICT_ID||(n="Vui lòng chọn quận/huyện"):n="Vui lòng chọn tỉnh/thành phố":n="Vui lòng nhập địa chỉ":n="Vui lòng nhập số điện thoại":n="Vui lòng nhập tên",n}},template:{createTemplateCart:function(n){for(var t=[],i,u,f,r=0;r<n.length;r++){for(i=n[r],t.push('<div class="item_minicart cf" data-id="'+i.PRODUCT_ID+'">'),t.push('<h3> <a href="'+i.URL_RETURN+'" target="_blank">'+i.PRODUCT_NAME+" <\/a><\/h3>"),t.push('<a href="'+i.URL_RETURN+'" target="_blank" style="float: left; margin-right:10px"> <img src="'+i.PRODUCT_IMAGE_FORMAT+'" width="90" alt=""><\/a>'),t.push('<div class="qty">'),t.push("Số lượng:"),t.push('<input value="'+i.QUANTITY+'" size="4" class="txtCartQty" maxlength="12" />'),t.push('x <span class="total_item"> '+i.PRODUCT_PRICE_PROMOS_FORMAT+"<\/span>"),t.push(" <\/div>"),t.push('Thành tiền: <b style="color: #FF0000">'+i.TOTAL_PRICE_FORMAT+"<\/b>"),t.push('<div class="detail_gift">'),u=0;u<i.GIF_PRODUCT.length;u++)f=i.GIF_PRODUCT[u],t.push('<div class="cart_product_item">'),t.push("<ul>"),t.push('<li class="cart_product_name"> <span class="fl cart_product_images"> <img src="'+f.PRODUCT_IMAGE_FORMAT+'"> <\/span> <span class="cart_product_info">'),t.push('<p class="cart_product_title"><a href="'+f.URL_RETURN+'" target="_blank">'+f.PRODUCT_NAME+"<\/a><\/p>"),t.push("<\/span> <\/li>"),t.push(' <li class="cart_product_count"><span class="add_number_cart"><span class="txtQty_cart">'+i.QUANTITY+"<\/span><\/span><\/li>"),t.push('<li class="cart_product_money is_promotion">Tặng kèm<\/li>'),t.push("<\/ul>"),t.push("<\/div>");t.push("<\/div>");t.push('<div class="clearcart"> <a href="#" class="checkout_remove_item btn-remove">X<\/a> <\/div>');t.push("<\/div>")}return t}}};n(function(){t.urlObj.getCart="/Cart/GetCarts";t.urlObj.updateCart="/Cart/UpdateCart";t.urlObj.deleteCart="/Cart/DeleteCart";t.urlObj.getDistrict="/Payment/GetDistrict";t.urlObj.payment="/Payment/Payment";t.urlObj.checkVoucher="/Payment/CheckVoucher";t.urlObj.getShip="/Payment/GetShip";t.init()})}(window.jQuery)